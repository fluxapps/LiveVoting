var xlvoPlayer={init:function(a){var b=a,c=/amp;/g;b.base_url=b.base_url.replace(c,""),this.config=b,this.ready=!0,xlvoPlayer.log(this.config);var d=$("#xlvo-display-player").children();$("#xlvo-display-player").css("height",d.css("height")),xlvoPlayer.config.use_mathjax&&!!MathJax&&MathJax.Hub.Config(xlvoPlayer.mathjax_config)},mathjax_config:{"HTML-CSS":{scale:80}},buttons_handled:!1,toolbar_loaded:!1,delay:1e3,counter:1,timeout:null,request_pending:!1,forced_update_interval:10,countdown_running:!1,config:{base_url:"",voter_count_element_id:"",lng:{voting_confirm_reset:"Reset?"},status_running:-1,use_mathjax:!1,debug:!1},player:{is_first:!0,is_last:!1,status:-1,active_voting_id:-1,show_results:!1,frozen:!0,votes:0,last_update:0,attendees:0,countdown:0,has_countdown:!1,xlvo_ppt:!1},player_html:null,run:function(){xlvoPlayer.log("running player"),this.registerElements(),this.getPlayerData()},handleFullScreen:function(){var a=$("div.ilTabsContentOuter");if(!1==xlvoPlayer.config.xlvo_ppt){this.btn_close_fullscreen.parent().hide();var b=a[0],c=this;this.btn_start_fullscreen.click(function(a){a.preventDefault(),screenfull.enabled&&screenfull.request(b)}),this.btn_close_fullscreen.click(function(a){a.preventDefault(),screenfull.enabled&&screenfull.exit(b)}),screenfull.enabled&&document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?(a.addClass("xlvo-fullscreen"),c.btn_start_fullscreen.parent().hide(),c.btn_close_fullscreen.parent().show()):(a.removeClass("xlvo-fullscreen"),c.btn_start_fullscreen.parent().show(),c.btn_close_fullscreen.parent().hide());var b=$("#xlvo-display-player").children();$("#xlvo-display-player").css("height",b.css("height"))})}else this.btn_start_fullscreen.parent().hide(),this.btn_close_fullscreen.parent().hide(),a.addClass("xlvo-fullscreen")},registerElements:function(){!1==xlvoPlayer.config.xlvo_ppt&&$(document).keydown(function(a){switch(a.which){case xlvoPlayer.config.keyboard.toggle_results:xlvoPlayer.callPlayer("toggle_results");break;case xlvoPlayer.config.keyboard.toggle_freeze:xlvoPlayer.callPlayer("toggle_freeze");break;case 66:if("INPUT"!==$(":focus").prop("tagName"))xlvoPlayer.callPlayer("toggle_freeze");else return;break;case 33:case xlvoPlayer.config.keyboard.previous:xlvoPlayer.callPlayer("previous");break;case 34:case xlvoPlayer.config.keyboard.next:xlvoPlayer.callPlayer("next");break;default:return;}a.preventDefault()}),this.btn_freeze=$("#btn-freeze"),this.btn_previous=$("#btn-previous"),this.btn_next=$("#btn-next"),this.btn_unfreeze=$("#btn-unfreeze"),this.btn_unfreeze.closest(".btn-group").hide(),this.btn_reset=$("#btn-reset"),this.btn_terminate=$("#btn-terminate"),this.btn_terminate.parent().hide(),this.btn_reset.parent().attr("disabled",!0),this.btn_hide_results=$("#btn-hide-results"),this.btn_show_results=$("#btn-show-results"),this.btn_toggle_pull=$("#btn-toggle-pull"),this.btn_show_results.parent().hide(),this.btn_start_fullscreen=$("#btn-start-fullscreen"),this.btn_close_fullscreen=$("#btn-close-fullscreen"),this.div_display_results=$("#xlvo-display-results"),this.toolbar=$("nav.ilToolbar"),this.toolbar.prepend("<div id=\"xlvo_player_loading\"><div class=\"bounce1\"></div><div class=\"bounce2\"></div><div class=\"bounce3\"></div></div>"),this.toolbar_loader=$("#xlvo_player_loading"),this.toolbar_loader.show(),this.btn_freeze.click(function(){return xlvoPlayer.callPlayer("toggle_freeze"),!1}),this.btn_unfreeze.click(function(){return xlvoPlayer.callPlayer("toggle_freeze"),!1}),this.btn_hide_results.click(function(){return xlvoPlayer.callPlayer("toggle_results"),!1}),this.btn_show_results.click(function(){return xlvoPlayer.callPlayer("toggle_results"),!1}),this.btn_reset.click(function(){return window.confirm(xlvoPlayer.config.lng.voting_confirm_reset)&&xlvoPlayer.callPlayer("reset"),!1}),this.btn_next.click(function(){return xlvoPlayer.callPlayer("next"),!1}),this.btn_previous.click(function(){return xlvoPlayer.callPlayer("previous"),!1}),this.btn_toggle_pull&&this.btn_toggle_pull.click(function(){xlvoPlayer.togglePull()}),this.handleFullScreen()},initElements:function(){if(this.player.frozen?(this.btn_freeze.parent().hide(),this.btn_unfreeze.closest(".btn-group").show(),0<this.player.votes?this.btn_reset.removeAttr("disabled"):this.btn_reset.attr("disabled","disabled")):(this.btn_unfreeze.closest(".btn-group").hide(),this.btn_freeze.parent().show(),this.btn_reset.attr("disabled","disabled")),this.player.show_results?(this.btn_hide_results.parent().show(),this.btn_show_results.parent().hide(),this.div_display_results.show()):(this.btn_hide_results.parent().hide(),this.btn_show_results.parent().show(),this.div_display_results.hide()),this.player.is_last&&(this.btn_next.attr("disabled","disabled"),this.btn_previous.removeAttr("disabled")),this.player.is_first&&(this.btn_previous.attr("disabled","disabled"),this.btn_next.removeAttr("disabled")),this.player.is_last||this.player.is_first||(this.btn_next.removeAttr("disabled"),this.btn_previous.removeAttr("disabled")),this.player.is_last&&this.player.is_first&&(this.btn_next.attr("disabled","disabled"),this.btn_previous.attr("disabled","disabled")),0<this.player.attendees){var a=document.getElementById("xlvo-attendees");a.innerHTML=this.player.attendees}},startRequest:function(){xlvoPlayer.request_pending=!0},endRequest:function(){xlvoPlayer.request_pending=!1},isRequestPending:function(){return xlvoPlayer.request_pending},clearTimeout:function(){xlvoPlayer.timeout&&(xlvoPlayer.log("clear timeout"),clearTimeout(xlvoPlayer.timeout))},getPlayerData:function(){return xlvoPlayer.isRequestPending()?void xlvoPlayer.log("Pause getPlayerData due to running POST"):void(xlvoPlayer.startRequest(),$.get(xlvoPlayer.config.base_url,{cmd:"getPlayerData"}).done(function(a){if(xlvoPlayer.counter++,xlvoPlayer.counter>xlvoPlayer.forced_update_interval||a.player.last_update!==xlvoPlayer.player.last_update||a.player.show_results!==xlvoPlayer.player.show_results||a.player.status!==xlvoPlayer.player.status||a.player.active_voting_id!==xlvoPlayer.player.active_voting_id||xlvoPlayer.player.has_countdown){var b=a.player_html;if(null!==xlvoPlayer.player_html&&xlvoPlayer.player_html!==b){var c=$(b),d=$("#xlvo-display-player").children();$("#xlvo-display-player").append(c),$("#xlvo-display-player").css("height",c.css("height")),d.fadeOut(200,function(){d.remove()}.bind(d)),xlvoPlayer.config.use_mathjax&&!!MathJax&&(xlvoPlayer.log("kick mathjax"),MathJax.Hub.Config(xlvoPlayer.mathjax_config),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"xlvo-display-player"])),xlvoPlayer.counter=0,xlvoPlayer.buttons_handled=!1}}xlvoPlayer.player=a.player,xlvoPlayer.player_html=a.player_html,xlvoPlayer.handleQuestionButtons(a.buttons_html),xlvoPlayer.initElements(),xlvoPlayer.timeout=setTimeout(xlvoPlayer.getPlayerData,xlvoPlayer.delay)}).always(function(){xlvoPlayer.endRequest()}))},handleSwitch:function(){xlvoPlayer.buttons_handled=!1,xlvoPlayer.counter=99,xlvoPlayer.endRequest()},callPlayer:function(a,b){xlvoPlayer.isRequestPending()&&xlvoPlayer.log("There is already a request"),xlvoPlayer.startRequest(),xlvoPlayer.toolbar_loader.show();var b=b?b:{},c=$.extend({call:a},b);$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",c).always(function(){xlvoPlayer.handleSwitch(),xlvoPlayer.getPlayerData()})},callButton:function(a,b){xlvoPlayer.isRequestPending()||(xlvoPlayer.startRequest(),xlvoPlayer.toolbar_loader.show(),this.log("call Button: "+a),$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",{call:"button",button_id:a,button_data:b}).done(function(){}).fail(function(){}).always(function(){xlvoPlayer.handleSwitch(),xlvoPlayer.getPlayerData()}))},open:function(a){return this.callPlayer("open",{xvi:a}),!1},updateAttendees:function(){xlvoPlayer.isRequestPending()||(xlvoPlayer.startRequest(),$.get(this.base_url,{cmd:"getAttendees"}).done(function(a){$("#xlvo-attendees").html(a),xlvoPlayer.timeout=setTimeout(xlvoPlayer.updateAttendees,1e3)}).always(function(){xlvoPlayer.endRequest()}))},handleStartButton:function(){var a=$(".xlvo-preview");a.disableSelection(),a.click(function(b){return xlvoPlayer.clearTimeout(),!b.shiftKey||(window.location.href=a.attr("href")+"&preview=1&key=1",!1)})},handleQuestionButtons:function(a){if(xlvoPlayer.buttons_handled)return void this.log("buttons already handled for this question");var b=$("<div/>").html(a).contents(),c=b.find("ul.nav"),d=c.find(".btn").length,e=this.toolbar.find("ul.nav").last(),f=e.find("li#dynamic_sep");return 1>d||!a||""===a?(0<f.length&&(f.nextAll().remove(),f.remove()),xlvoPlayer.log("there are no custom buttons"),xlvoPlayer.log(a),xlvoPlayer.buttons_handled=!0,void xlvoPlayer.toolbar_loader.hide()):void(xlvoPlayer.log("there are custom buttons!"),c.find(".btn").each(function(){$(this).addClass("xlvo_custom_button")}),0<f.length?(xlvoPlayer.log("removing everything after separator"),f.nextAll().remove()):(xlvoPlayer.log("appending separator"),e.append("<li id='dynamic_sep' class='ilToolbarSeparator hidden-xs'></li>")),e.append(c.html()),e.find(".xlvo_custom_button").on("click",function(a){a.preventDefault(),xlvoPlayer.callButton($(this).attr("id"),!0)}),xlvoPlayer.toolbar_loader.hide(),xlvoPlayer.buttons_handled=!0)},countdown:function(a,b){a.preventDefault(),xlvoPlayer.countdown_running=!0,xlvoPlayer.log("Countdown started: "+b),xlvoPlayer.callPlayer("countdown",{seconds:b})},togglePull:function(){xlvoPlayer.timeout?(alert("Pull stopped"),xlvoPlayer.clearTimeout(),xlvoPlayer.timeout=!1):(alert("Pull started"),xlvoPlayer.getPlayerData())},log:function(a){this.config.debug&&console.log(a)},debug:function(){this.config.debug=!0},stop:function(){this.config.debug=!1}};